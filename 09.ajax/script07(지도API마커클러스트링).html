<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <style>
        
        #map {
        margin: 0 auto;
        text-align: center;
        height: 80%;
        width: 80%;
        }
        
        html, body {
          height: 100%;
          margin: 0;
          padding: 0;
        }

      </style>

</head>
<body>
    <h2 align = "center">코로나19 마스크 현황</h2>    
    <div id="map"></div>
    <script>
        var map;
        //지도에 맵을 생성하는 코드
        function initMap() {
          map = new google.maps.Map(document.getElementById('map'), {
            zoom: 2,
            center: new google.maps.LatLng(2.8,-187.3)
            
          });

          //sdk땡겨오는 코드
          var script = document.createElement('script');
          script.src = 'https://developers.google.com/maps/documentation/javascript/examples/json/earthquake_GeoJSONP.js';
          document.getElementsByTagName('head')[0].appendChild(script);
        }
  
        //마커를 루프로 돌려서 화면에 찍어주는 코드
        // window.eqfeed_callback = function(results) {

        //     console.log(results);
        //   for (var i = 0; i < results.features.length; i++) {
        //     var coords = results.features[i].geometry.coordinates;
        //     var latLng = new google.maps.LatLng(coords[1],coords[0]);
        //     var marker = new google.maps.Marker({
        //       position: latLng,
        //       map: map
        //     });
        //   }
        // }



    var lat;
    var lng;
    //위치정보의 성공 함수
    function ajax(position) {
         lat = position.coords.latitude;
         lng = position.coords.longitude;

        fetch(`https://8oi9s0nnth.apigw.ntruss.com/corona19-masks/v1/storesByGeo/json?lat=${lat}&lng=${lng}&m=5000`).then(function (response) {

            if (response.status !== 200) {
                alert("경로탐색이 불가합니다.")
            } else {
                return response.json();
            }
        }).then(function (publicData) {
            console.log(publicData);
            //맵을 생성하는 코드
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 13,
                center: new google.maps.LatLng(lat ,lng)
        })


        //마커를 루프로 돌려서 화면에 찍어주는 코드
        window.eqfeed_callback = function(results) {

            console.log(results);
            
          for (var i = 0; i < results.features.length; i++) {
            var coords = results.features[i].geometry.coordinates;
            var latLng = new google.maps.LatLng(lat ,lng);
            var marker = new google.maps.Marker({
              position: latLng,
              map: map
            });
          }
        }
     })
    }//ajax end


        //위치정보의 실패 함수
        function coordFail(position){

        }

        (function(){
            navigator.geolocation.getCurrentPosition(ajax, coordFail);
        })();



      </script>
      <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDyLzsJtLB_3HSliwkBmK5NOF5UveCn97k&callback=initMap">
      </script>
</body>
</html>